# üöÄ Render.com Deployment Guide

Complete guide for deploying Dicee Battle to Render.com with email functionality.

## üìã Prerequisites

- GitHub account with your project repository
- Render.com account ([Sign up free](https://render.com))
- Email service provider account (Gmail, SendGrid, etc.)

## üõ†Ô∏è Deployment Methods

### Method 1: Automatic Deployment (Recommended)

This method uses the included `render.yaml` file for zero-configuration deployment.

1. **Connect Repository to Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub account if not already connected
   - Select your repository
   - Click "Connect"

2. **Configure Blueprint**
   - Render will automatically detect the `render.yaml` file
   - Review the configuration
   - Click "Apply"

3. **Set Environment Variables** (Optional)
   - Go to your service settings
   - Add environment variables for email functionality:
     ```
     SMTP_HOST=smtp.gmail.com
     SMTP_USER=your-email@gmail.com
     SMTP_PASS=your-app-password
     FROM_EMAIL=your-email@gmail.com
     ```

4. **Deploy**
   - Render will automatically build and deploy your application
   - Your app will be available at the provided URL

### Method 2: Manual Deployment

1. **Create New Web Service**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

2. **Configure Service**
   ```
   Name: dicee-battle-game
   Environment: Node
   Region: Oregon (US West) or Frankfurt (Europe)
   Branch: main
   Build Command: npm install
   Start Command: npm start
   Instance Type: Free
   ```

3. **Advanced Settings**
   ```
   Health Check Path: /health
   Auto Deploy: Yes
   ```

4. **Environment Variables**
   ```
   NODE_ENV=production
   SESSION_SECRET=<auto-generated by Render>
   
   # Email Configuration (Optional)
   SMTP_HOST=smtp.gmail.com
   SMTP_PORT=587
   SMTP_SECURE=false
   SMTP_USER=your-email@gmail.com
   SMTP_PASS=your-app-password
   FROM_EMAIL=your-email@gmail.com
   ```

5. **Deploy**
   - Click "Create Web Service"
   - Wait for the build and deployment to complete

## üìß Email Configuration Guide

### Gmail Setup (Recommended for Testing)

1. **Enable 2-Factor Authentication**
   - Go to [Google Account Security](https://myaccount.google.com/security)
   - Enable 2-Step Verification

2. **Create App Password**
   - Go to [App Passwords](https://myaccount.google.com/apppasswords)
   - Select "Mail" and "Other (Custom name)"
   - Enter "Dicee Battle" as the name
   - Copy the generated 16-character password

3. **Configure Environment Variables**
   ```
   SMTP_HOST=smtp.gmail.com
   SMTP_PORT=587
   SMTP_SECURE=false
   SMTP_USER=your-gmail@gmail.com
   SMTP_PASS=xxxx xxxx xxxx xxxx  # App password from step 2
   FROM_EMAIL=your-gmail@gmail.com
   ```

### SendGrid Setup (Recommended for Production)

1. **Create SendGrid Account**
   - Sign up at [SendGrid](https://sendgrid.com)
   - Verify your account

2. **Create API Key**
   - Go to Settings ‚Üí API Keys
   - Create a new API key with "Full Access"
   - Copy the API key

3. **Configure Environment Variables**
   ```
   SMTP_HOST=smtp.sendgrid.net
   SMTP_PORT=587
   SMTP_SECURE=false
   SMTP_USER=apikey
   SMTP_PASS=your-sendgrid-api-key
   FROM_EMAIL=noreply@yourdomain.com
   ```

### Other Email Providers

**Mailgun**:
```
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=postmaster@your-domain.mailgun.org
SMTP_PASS=your-mailgun-password
FROM_EMAIL=noreply@yourdomain.com
```

**AWS SES**:
```
SMTP_HOST=email-smtp.us-east-1.amazonaws.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-ses-access-key
SMTP_PASS=your-ses-secret-key
FROM_EMAIL=noreply@yourdomain.com
```

## üîß Post-Deployment Configuration

### 1. Test Your Application

1. **Visit Your App URL**
   - Open the URL provided by Render
   - Should redirect to login page

2. **Test Registration**
   - Create a new account
   - Verify successful registration and auto-login

3. **Test Password Reset**
   - Go to login page
   - Click "Forgot Password?"
   - Enter your email
   - Check your email for reset link

### 2. Custom Domain (Optional)

1. **Add Custom Domain**
   - Go to your service settings
   - Click "Custom Domains"
   - Add your domain name

2. **Configure DNS**
   - Add CNAME record pointing to your Render URL
   - Wait for DNS propagation

3. **SSL Certificate**
   - Render automatically provides SSL certificates
   - Your site will be available at `https://yourdomain.com`

### 3. Monitoring and Logs

1. **View Logs**
   - Go to your service dashboard
   - Click "Logs" tab
   - Monitor for any errors

2. **Health Checks**
   - Render automatically monitors `/health` endpoint
   - Service will restart if health checks fail

## üîç Troubleshooting

### Common Issues

**1. Build Failures**
```bash
# Check logs for:
- npm install errors
- Missing dependencies
- Node.js version compatibility
```

**Solutions**:
- Ensure Node.js version in `package.json` engines
- Check all dependencies are listed correctly
- Clear npm cache if needed

**2. Application Won't Start**
```bash
# Check for:
- Port binding issues
- Environment variable problems
- Database connection errors
```

**Solutions**:
- Ensure `PORT` environment variable is used
- Verify all required environment variables are set
- Check database file permissions

**3. Email Not Working**
```bash
# Common issues:
- Invalid SMTP credentials
- Firewall blocking SMTP ports
- App passwords not used for Gmail
```

**Solutions**:
- Verify SMTP settings with email provider
- Use app-specific passwords for Gmail
- Check Render logs for email errors

**4. Database Issues**
```bash
# SQLite problems:
- Database file not writable
- Disk space issues
- Connection timeouts
```

**Solutions**:
- Database is stored in `/tmp` on Render (ephemeral)
- For persistent data, consider upgrading to PostgreSQL
- Monitor disk usage in Render dashboard

### Performance Issues

**1. Slow Response Times**
- Check Render region (choose closest to users)
- Monitor resource usage
- Consider upgrading from Free tier

**2. Memory Issues**
- Set `NODE_OPTIONS=--max-old-space-size=512` environment variable
- Monitor memory usage in dashboard
- Optimize database queries

### Security Checklist

- [ ] `SESSION_SECRET` is set to a secure random value
- [ ] `NODE_ENV` is set to `production`
- [ ] SMTP credentials are kept secure
- [ ] No sensitive data in repository
- [ ] HTTPS is enabled (automatic on Render)

## üìä Monitoring and Maintenance

### Health Monitoring

The application includes a health check endpoint at `/health` that provides:
- Server status
- Uptime information
- Current timestamp

### Log Monitoring

Monitor these log patterns:
```bash
# Successful operations
"Login successful"
"Account created successfully"
"Password reset email sent"

# Errors to watch
"Database error"
"Email sending failed"
"Session save error"
```

### Performance Metrics

Monitor in Render dashboard:
- Response times
- Memory usage
- CPU usage
- Request volume

## üîÑ Updates and Maintenance

### Automatic Deployments

- Push changes to your main branch
- Render automatically builds and deploys
- Zero downtime deployments

### Manual Deployments

- Go to service dashboard
- Click "Manual Deploy"
- Select branch and deploy

### Database Backups

**Important**: SQLite on Render is ephemeral (data may be lost during restarts)

For production use:
1. **Upgrade to PostgreSQL**:
   - Add PostgreSQL service in Render
   - Update connection strings
   - Migrate data

2. **Regular Backups**:
   - Export user data periodically
   - Store backups in external storage

## üìà Scaling Considerations

### Free Tier Limitations
- 512MB RAM
- Sleeps after 15 minutes of inactivity
- 750 hours per month

### Upgrade Benefits
- Always-on service (no sleeping)
- More RAM and CPU
- Faster build times
- Priority support

### When to Upgrade
- > 100 daily active users
- Need 99.9% uptime
- Performance becomes critical
- Database persistence required

## üÜò Support and Resources

### Render Support
- [Render Documentation](https://render.com/docs)
- [Community Forum](https://community.render.com)
- [Status Page](https://status.render.com)

### Project Support
- Check application logs first
- Review this deployment guide
- Test locally before deploying
- Monitor health check endpoint

---

## ‚úÖ Deployment Checklist

Before deploying:
- [ ] Repository is public or Render has access
- [ ] All dependencies are in `package.json`
- [ ] Environment variables are configured
- [ ] Email service is set up (optional)
- [ ] Health check endpoint works locally

After deploying:
- [ ] Application loads successfully
- [ ] User registration works
- [ ] Login/logout functions properly
- [ ] Password reset sends emails
- [ ] Game functionality works
- [ ] Mobile responsiveness verified

üéâ **Congratulations!** Your Dicee Battle game is now live on Render.com!